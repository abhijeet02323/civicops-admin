<%- include('../layout', { admin: admin, title: 'Map View', body: (function(){ %>
  <div id="map" class="map-container"></div>

  <script src="https://cdn.jsdelivr.net/npm/ol@7.5.2/dist/ol.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@7.5.2/ol.css">

  <script>
    (function(){
  const locations = <%- JSON.stringify(locations || []) %>;
      // create map
      const map = new ol.Map({
        target: 'map',
        layers: [new ol.layer.Tile({ source: new ol.source.OSM() })],
        view: new ol.View({ center: ol.proj.fromLonLat([78.9629,20.5937]), zoom: 5 })
      })

      const features = locations.map(loc => {
        const f = new ol.Feature({ geometry: new ol.geom.Point(ol.proj.fromLonLat([loc.longitude, loc.latitude])), data: loc })
        return f
      })

      const vectorSource = new ol.source.Vector({ features })
      const vectorLayer = new ol.layer.Vector({ source: vectorSource })
      map.addLayer(vectorLayer)

      const overlay = new ol.Overlay({ element: document.createElement('div') })
      map.addOverlay(overlay)

      map.on('click', function(evt){
        map.forEachFeatureAtPixel(evt.pixel, function(feature){
          const data = feature.get('data')
          alert(data.title + '\n' + (data.address || ''))
        })
      })
    })()
  </script>

  <style>
    .map-container { width: 100%; height: 600px; border-radius: 8px; }
  </style>
<% })() }) %>
